function scriptText = custom_genscript(varargin)
    %GENSCRIPT Generate a MATLAB script for running tests.
    scriptText = join([ ...
        "import matlab.unittest.TestRunner;", ...
        "import matlab.unittest.plugins.XMLPlugin;", ...
        newline, ...
        "suite = testsuite(pwd, 'IncludingSubfolders', true);", ...
        "testFiles = unique({suite.TestParentName});", ...
        newline, ...
        "tempFile = tempname;", ...
        "testFileStr = strjoin(testFiles, '\n');", ...
        "disp(testFileStr);", ...
        "command = sprintf('echo %s | circleci tests split --split-by=timings 2> %s', testFileStr, tempFile);", ...
        "[status, stdout] = system(command);", ...
        newline, ...
        "disp(stdout);", ...
        "suite = testsuite_generation(stdout, tempFile);", ...
        newline, ...
        "delete(tempFile);", ...
        newline, ...
        "runner = TestRunner.withTextOutput();", ...
        "runner.addPlugin(XMLPlugin.producingJUnitFormat('results.xml'));", ...
        newline, ...
        "results = runner.run(suite);", ...
        "display(results);", ...
        "assertSuccess(results);" ...
    ], newline);

    % Convert to character array 
    scriptText = char(scriptText);
end